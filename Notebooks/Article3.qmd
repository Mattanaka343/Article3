---
title: "Cómo el Lenguaje Afecta Nuestras Emociones: Clasificacióon de Historias de Terror"
authors:
- Mateo Yañez-Tanaka
- Jorge Sánchez-Ponce
- Fernando Ramos-Valdez
- Fernando Pavía-González
format:
  html:
    toc: true
    html-math-method: katex
    embed-resources: true
    self-contained-math: true
    df-print: kable
  pdf:
    toc: true
    documentclass: article
    number-sections: true
    df-print: kable
    include-in-header: ../Resources/header.tex
editor: source
bibliography: ../Resources/references.bib
---
```{R}
#| include: false
knitr::opts_chunk$set(echo = FALSE)

```

## Abstract

## Introducción

## Metodología

## Aplicación

Para este proyecto se utilizaron las historias de terror contenidas en *[Your Ghost Stories](https://www.yourghoststories.com/real-ghost-stories.php)*. Se decidió que se trataría únicamente con dos tipos de historias, aquellas que son sobre demonios, posesiones o exorcismos o aquellas que son sore poltergeists o manifestaciones físicas. Para generar los datos que se usaron para el clasificador se hizo una técnica conocida como *web scraping* que nos permite recolectar el texto que contiene una página web y se recolectaron únicamente las descripciones, el tipo de historia del que se trata, el lugar donde ocurrió y el título del relato. Se recolectaron **50** histarias de ambas categorías de modo que los datos estuvieran bvalnaceados.

```{R}
library(tidyverse)
library(tidytext)
library(rvest)
source('../Scripts/StoryScrape.R')

html1 = read_html('https://www.yourghoststories.com/ghost-stories-categories.php?category=10&page=1')
html2 = read_html('https://www.yourghoststories.com/ghost-stories-categories.php?category=2&page=1')

poltergeist_links = html2 |> html_elements('.rowlight a') |> html_attr('href')
poltergeist_links =  paste0('https://www.yourghoststories.com/', poltergeist_links)

possession_links = html1 |> html_elements('.rowlight a') |> html_attr('href')
possession_links =  paste0('https://www.yourghoststories.com/', possession_links)

possession_stories =  do.call(rbind, lapply(possession_links, StoryScrape))
poltergeist_stories = do.call(rbind, lapply(poltergeist_links, StoryScrape))

all_stories = rbind(possession_stories,poltergeist_stories)
```

```{R}
```


```{R}
head(all_stories)
library(knitr)

words= all_stories |> unnest_tokens(output = word, input = text)
words
```
```{R}
words |>
  anti_join(stop_words) |>
  count(title, word, sort = TRUE) |>
  group_by(title) |>
  slice_head(n = 10) |>
  pivot_wider(
    names_from = title, 
    values_from = n,
    values_fn = as.character,
    values_fill = "Not in top 10"
    ) |>
  kable()  
```

```{R}
words |>
  anti_join(stop_words) |>
  count(title, word, sort = TRUE) |>
  group_by(title) |>
  slice_head(n = 10) |>
  filter(title %in% unique(title)[1:10]) |>

  ggplot(aes(y = reorder_within(word, n, title), x = n, fill = title)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~title, scales = "free") +
  scale_y_reordered() +

  labs(y = NULL)
```

```{R}
words |>
  anti_join(stop_words) |>
  count(title, word, sort = TRUE) |>
  group_by(title) |>
  slice_head(n = 10) |>
  ungroup() |>
  # limitar a 10 títulos
  filter(title %in% unique(title)[1:10]) |>
  ggplot(aes(y = reorder_within(word, n, title), x = n, fill = title)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~title, scales = "free") +
  scale_y_reordered() +
  labs(y = NULL)

```


```{R}
spooky_matrix = 
```

## Conclusión


